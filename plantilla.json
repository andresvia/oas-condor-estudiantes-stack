{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "ELB": {
      "Type": "AWS::ElasticLoadBalancing::LoadBalancer",
      "Properties": {
        "SecurityGroups": [
          {
            "Ref": "ELBSG"
          }
        ],
        "Listeners": [
          {
             "InstancePort" : "80",
             "LoadBalancerPort" : "80",
             "Protocol" : "HTTP"
          }
        ]
      }
    },
    "ASGCONFIG": {
      "Type": "AWS::AutoScaling::LaunchConfiguration",
      "Properties": {
        "SecurityGroups": [
          {
            "Ref": "ASGSG"
          }
        ],
        "ImageId": "ami-f4de1b99"
      }
    },
    "ASG": {
      "Type": "AWS::AutoScaling::AutoScalingGroup",
      "Properties": {
        "LoadBalancerNames": [
          {
            "Ref": "ELB"
          }
        ],
        "LaunchConfigurationName": {
          "Ref": "ASGCONFIG"
        }
      }
    },
    "ASGSG": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Security Group Externo"
      }
    },
    "ELBSG": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Security Group Interno"
      }
    },
    "ASGINGRESS": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "GroupId": {
          "Ref": "ASGSG"
        },
        "SourceSecurityGroupId": {
          "Ref": "ELBSG"
        }
      }
    }
  }
}
