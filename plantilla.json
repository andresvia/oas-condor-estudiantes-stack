{
  "AWSTemplateFormatVersion": "2010-09-09",
  "Resources": {
    "ELB": {
      "Type": "AWS::ElasticLoadBalancing::LoadBalancer",
      "Properties": {
        "SecurityGroups": [
          { "Fn::GetAtt" : [ "ELBSG" , "GroupId" ] }
        ],
        "Listeners": [
          {
             "InstancePort" : "80",
             "LoadBalancerPort" : "80",
             "Protocol" : "HTTP"
          }
        ],
        "Subnets": [ "subnet-03ac6375", "subnet-f712f4af" ]
      }
    },
    "ASGCONFIG": {
      "Type": "AWS::AutoScaling::LaunchConfiguration",
      "Properties": {
        "SecurityGroups": [
          { "Fn::GetAtt" : [ "ASGSG" , "GroupId" ] }
        ],
        "ImageId": "ami-f4de1b99",
        "InstanceType": "t2.micro"
      }
    },
    "ASG": {
      "Type": "AWS::AutoScaling::AutoScalingGroup",
      "Properties": {
        "LoadBalancerNames": [
          {
            "Ref": "ELB"
          }
        ],
        "LaunchConfigurationName": {
          "Ref": "ASGCONFIG"
        },
        "MinSize": "0",
        "MaxSize": "0",
        "VPCZoneIdentifier": [ "subnet-03ac6375", "subnet-f712f4af" ]
      }
    },
    "ASGSG": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Security Group Interno"
      }
    },
    "ELBSG": {
      "Type": "AWS::EC2::SecurityGroup",
      "Properties": {
        "GroupDescription": "Security Group Externo"
      }
    },
    "ASGINGRESS": {
      "Type": "AWS::EC2::SecurityGroupIngress",
      "Properties": {
        "GroupId": {
          "Fn::GetAtt" : [ "ASGSG" , "GroupId" ]
        },
        "SourceSecurityGroupId": {
          "Fn::GetAtt" : [ "ELBSG" , "GroupId" ]
        },
        "IpProtocol": "80"
      }
    }
  }
}
